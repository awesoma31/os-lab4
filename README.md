# Лабораторная работа №4

> P3331 Чураков А. А.
>
> Продвинутый трек. Оценка 4/5. ЛР 4.
>
> Преподаватель: Дворкин Борис Б. А.

## Реализация простой файловой системы в ядре Linux

## Цель работы

Целью лабораторной работы является изучение архитектуры виртуальной файловой системы в ядре Linux и получение практических навыков разработки модулей ядра. В рамках работы реализована простая файловая система **VTFS**, подключаемая в виде модуля ядра, поддерживающая базовые операции с файлами и директориями.


## Краткое описание реализованной файловой системы

VTFS — это файловая система, реализованная в виде **модуля ядра Linux**, которая:

* не использует физическое блочное устройство;
* хранит данные в оперативной памяти;
* поддерживает базовые файловые операции.

Со стороны пользователя VTFS ведёт себя как обычная файловая система и монтируется стандартной командой `mount`.

## Реализованный функционал

### 1. Модуль ядра

* Реализованы функции инициализации и выгрузки модуля (`module_init`, `module_exit`)
* Используется `printk` для вывода сообщений в системный лог
* Реализована корректная регистрация и удаление файловой системы (`register_filesystem`, `unregister_filesystem`)

### 2. Монтирование файловой системы

* Реализована функция `vtfs_mount`
* Используется `mount_nodev`, так как файловая система не привязана к физическому устройству
* Реализована функция `vtfs_fill_super`, инициализирующая `super_block` и корневую директорию

### 3. Работа с inode и dentry

* Реализовано создание `inode` с помощью `new_inode`
* Настроены поля:

  * `i_mode`
  * `i_uid`, `i_gid`
  * `i_op`, `i_fop`
* Корневая директория имеет фиксированный номер inode

### 4. Навигация по файловой системе

* Реализована функция `lookup`
* Поддерживается корректный переход в директории (`cd`)
* Реализован вывод содержимого директорий через `iterate` (`ls`)

### 5. Создание и удаление файлов

* Реализованы операции:

  * `create` — создание файлов
  * `unlink` — удаление файлов
* Поддержана корректная работа утилит `touch` и `rm`

### 6. Хранение данных в оперативной памяти

* Содержимое файловой системы хранится в структурах данных в RAM
* Реализация отделена от логики VFS, что позволяет в дальнейшем заменить хранилище

### 7. Работа с директориями

* Реализованы операции:

  * `mkdir`
  * `rmdir`
* Поддерживается вложенность директорий

### 8. Чтение и запись файлов

* Реализованы операции:
  * `read`
  * `write`

### 9. Жёсткие ссылки

* Реализована поддержка жёстких ссылок для регулярных файлов


## Результаты работы

В ходе выполнения лабораторной работы:

* Изучена архитектура VFS в Linux
* Получены практические навыки разработки модулей ядра
* Реализована собственная файловая система с поддержкой основных операций
* Продемонстрирована интеграция пользовательских утилит Linux с кастомной ФС

## Выводы

В результате выполнения лабораторной работы была успешно реализована простая файловая система в ядре Linux. Работа позволила глубже понять принципы работы виртуальной файловой системы, устройство inode/dentry/superblock и особенности разработки в kernel-space.